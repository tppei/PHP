{"filter":false,"title":"result.php","tooltip":"/htdocs/mvc/result.php","ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":21,"column":0},"end":{"row":21,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":513,"mode":"ace/mode/php"}},"hash":"b6949f9f58906590daa771555249ae1342512336","mime":"application/octet-stream","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":2,"column":8},"end":{"row":2,"column":9},"action":"remove","lines":["込"],"id":8}],[{"start":{"row":2,"column":7},"end":{"row":2,"column":8},"action":"remove","lines":["み"],"id":9},{"start":{"row":2,"column":6},"end":{"row":2,"column":7},"action":"remove","lines":["読"]}],[{"start":{"row":2,"column":5},"end":{"row":2,"column":6},"action":"remove","lines":["ル"],"id":10}],[{"start":{"row":2,"column":4},"end":{"row":2,"column":5},"action":"remove","lines":["イ"],"id":11}],[{"start":{"row":2,"column":3},"end":{"row":2,"column":4},"action":"remove","lines":["ァ"],"id":12}],[{"start":{"row":2,"column":2},"end":{"row":2,"column":3},"action":"remove","lines":["フ"],"id":13}],[{"start":{"row":2,"column":1},"end":{"row":2,"column":2},"action":"remove","lines":["定"],"id":14}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":1},"action":"remove","lines":["設"],"id":15}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":6},"action":"insert","lines":["設定ファイル"],"id":16}],[{"start":{"row":2,"column":6},"end":{"row":2,"column":10},"action":"insert","lines":["読み込み"],"id":17}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":3},"action":"insert","lines":["// "],"id":18}],[{"start":{"row":2,"column":13},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":19}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":34},"action":"insert","lines":["require_once 'revender_const.php';"],"id":20}],[{"start":{"row":3,"column":34},"end":{"row":4,"column":0},"action":"insert","lines":["",""],"id":21}],[{"start":{"row":4,"column":0},"end":{"row":5,"column":34},"action":"insert","lines":["// 関数ファイル読み込み","require_once 'revender_model.php';"],"id":22}],[{"start":{"row":5,"column":34},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":23},{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""]},{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":8,"column":0},"end":{"row":174,"column":7},"action":"insert","lines":["<?php","$regexp_price = '/^[0-9]+$/';   //半角数字の正規表現","","$host = 'localhost';            // データベースのホスト名","$username = 'codecamp49497';    // MySQLのユーザ名","$passwd   = 'codecamp49497';    // MySQLのパスワード","$dbname   = 'codecamp49497';    // データベース名","$link = mysqli_connect($host, $username, $passwd, $dbname);","","// 変数初期化","$drink_id = '';","$post_err = [];","$err_msg = [];","?>","<!DOCTYPE html>","<html lang=\"ja\">","    <body>","        <h1>自動販売機結果</h1>","    <?php","    ","    // 投入金額のエラー","    ","    // 投入金額が入力されていない","    if(!$_POST['money']){","        print '<p>投入金額を入力してください</p>';","        $post_err[] = '投入金額を入力してください';","    }else if(!preg_match($regexp_price,$_POST['money'])){","        // 投入金額が正規表現外","        print  \"<p>投入金額は半角数字を入力してください</p>\";","        $post_err[] = \"投入金額は半角数字を入力してください\";","    }else if($_POST['money'] > 10000){","        // 投入金額が１万以上","        print \"<p>投入金額は1万円以下にしてください</p>\";","        $post_err[] = \"投入金額は1万円以下にしてください\";","    }","    ","    // 購入商品が選択されていないときのエラー","    if(!$_POST['drink_id']){","        print '<p>購入する商品を選択してください</p>';","        $post_err[] = '購入する商品を選択してください';","    }","    ","    // 投入金額と選択商品にエラーがないとき","    if(count($post_err) === 0){","        ","        // 現在時刻を取得","        $date = date('Y-m-d H:i:s');","        ","        // ドリンクid取得","        $drink_id = $_POST['drink_id'];","        ","         // トランザクション開始","        mysqli_autocommit($link, false);","        ","        ","        ","        if($link){","            ","            // 文字コードセット","            mysqli_set_charset($link, 'UTF8');","            ","            // 購入した商品情報取得のためのクエリ","            $sql = \"SELECT drink_details.ドリンクid,ドリンク名,商品画像,価格,在庫数,公開ステータス FROM drink_details JOIN drink_stock_table ON drink_details.ドリンクid = drink_stock_table.ドリンクid WHERE drink_details.ドリンクid = '$drink_id'\";","            ","            if($result = mysqli_query($link,$sql)){","                // 確認用","                // var_dump($drink_id);","                ","                // 結果を一行取り出す","                while($row = mysqli_fetch_assoc($result)){","                    ","                    // 購入したドリンク名取得","                    $drink_name = htmlspecialchars($row['ドリンク名']);","                    ","                    // 購入したドリンクのステータス取得　修正箇所　12/2/'21","                    $status = htmlspecialchars($row['公開ステータス']);","                    ","                    // 購入したドリンクの在庫数取得　修正箇所　12/2/'21","                    $stock = htmlspecialchars($row['在庫数']);","                    ","                    // 購入した商品画像取得　修正箇所　12/2/'21","                    $image = $row['商品画像'];","                    ","                     // 購入した商品価格取得　修正箇所　12/2/'21","                    $price = $row['価格'];","                    ","                }","                ","                // 公開ステータスが非公開の場合購入できない　修正箇所　12/2/'21","                if($status === '0'){","                        ","                    print '現在購入できません';","                        ","                }else{","                        ","                    // おつり計算","                    $charge = $_POST['money'] - $price;","                        ","                    // 在庫数が0個以下の場合購入できない　修正箇所　12/2/'21    ","                    if($stock <= 0){","                        ","                        print '売り切れました！';","                        ","                    }else{","                ","                        // 現在の在庫数から一つひく","                        $stock = $stock - 1;","                        ","                        // 投入金額 - 価格　< 0　の時","                        if($charge < 0){","                            print 'お金が足りません';","                        }else{","                    ","                        // 購入履歴表(drink_history_table)に購入日追加","                        $tohistory_sql = \"INSERT INTO drink_history_table (ドリンクID,購入日) VALUES($drink_id,'$date')\";","                            if(!$result = mysqli_query($link,$tohistory_sql)){","                                $err_msg[] = '購入日追加失敗';","                            }","                        ","                        // 在庫管理表(drink_stock_table)の更新日を更新","                        $tostock_date_sql = \"UPDATE drink_stock_table SET 更新日 = '$date' WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_date_sql)){","                                $err_msg[] = '在庫表更新日更新失敗';","                            }","                            ","                        // 在庫管理表(drink_stock_table)の在庫から一つ引いた数で更新","                        $tostock_stock_sql = \"UPDATE drink_stock_table SET 在庫数 = $stock WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_stock_sql)){","                                $err_msg[] = '在庫数更新失敗';","                                ","                            }","                    ","                        // 結果の表示","                        print '<img src=\"./image/'.$image.'\">';","                        print '<p>がしゃん!['.$drink_name.']が買えました！</p>';","                        print '<p>おつりは['.$charge.'円]です</p>';","                        ","                        }","                    }","                }","            }else{","                $err_msg[] = \"商品情報取得失敗\";","            }","            ","            // sqlでエラーがなければコミット","            if(count($err_msg) === 0){","                mysqli_commit($link);","            }else {","                mysqli_rollback($link);","            }","            ","            // 接続を閉じる","            mysqli_close($link);","        }else{","            $err_msg[] = 'error:' . mysqli_connect_error();","        }","       ","    }","    ?>","        ","        ","        ","    </body>","    <footer>","        <a href=\"index.php\">戻る</a>","    </footer>","</html>"],"id":24}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"remove","lines":["p"],"id":25},{"start":{"row":8,"column":3},"end":{"row":8,"column":4},"action":"remove","lines":["h"]},{"start":{"row":8,"column":2},"end":{"row":8,"column":3},"action":"remove","lines":["p"]},{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"remove","lines":["?"]},{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"remove","lines":["<"]}],[{"start":{"row":28,"column":4},"end":{"row":49,"column":4},"action":"remove","lines":["// 投入金額のエラー","    ","    // 投入金額が入力されていない","    if(!$_POST['money']){","        print '<p>投入金額を入力してください</p>';","        $post_err[] = '投入金額を入力してください';","    }else if(!preg_match($regexp_price,$_POST['money'])){","        // 投入金額が正規表現外","        print  \"<p>投入金額は半角数字を入力してください</p>\";","        $post_err[] = \"投入金額は半角数字を入力してください\";","    }else if($_POST['money'] > 10000){","        // 投入金額が１万以上","        print \"<p>投入金額は1万円以下にしてください</p>\";","        $post_err[] = \"投入金額は1万円以下にしてください\";","    }","    ","    // 購入商品が選択されていないときのエラー","    if(!$_POST['drink_id']){","        print '<p>購入する商品を選択してください</p>';","        $post_err[] = '購入する商品を選択してください';","    }","    "],"id":26}],[{"start":{"row":5,"column":34},"end":{"row":153,"column":7},"action":"remove","lines":["","","","","$regexp_price = '/^[0-9]+$/';   //半角数字の正規表現","","$host = 'localhost';            // データベースのホスト名","$username = 'codecamp49497';    // MySQLのユーザ名","$passwd   = 'codecamp49497';    // MySQLのパスワード","$dbname   = 'codecamp49497';    // データベース名","$link = mysqli_connect($host, $username, $passwd, $dbname);","","// 変数初期化","$drink_id = '';","$post_err = [];","$err_msg = [];","?>","<!DOCTYPE html>","<html lang=\"ja\">","    <body>","        <h1>自動販売機結果</h1>","    <?php","    ","    ","    // 投入金額と選択商品にエラーがないとき","    if(count($post_err) === 0){","        ","        // 現在時刻を取得","        $date = date('Y-m-d H:i:s');","        ","        // ドリンクid取得","        $drink_id = $_POST['drink_id'];","        ","         // トランザクション開始","        mysqli_autocommit($link, false);","        ","        ","        ","        if($link){","            ","            // 文字コードセット","            mysqli_set_charset($link, 'UTF8');","            ","            // 購入した商品情報取得のためのクエリ","            $sql = \"SELECT drink_details.ドリンクid,ドリンク名,商品画像,価格,在庫数,公開ステータス FROM drink_details JOIN drink_stock_table ON drink_details.ドリンクid = drink_stock_table.ドリンクid WHERE drink_details.ドリンクid = '$drink_id'\";","            ","            if($result = mysqli_query($link,$sql)){","                // 確認用","                // var_dump($drink_id);","                ","                // 結果を一行取り出す","                while($row = mysqli_fetch_assoc($result)){","                    ","                    // 購入したドリンク名取得","                    $drink_name = htmlspecialchars($row['ドリンク名']);","                    ","                    // 購入したドリンクのステータス取得　修正箇所　12/2/'21","                    $status = htmlspecialchars($row['公開ステータス']);","                    ","                    // 購入したドリンクの在庫数取得　修正箇所　12/2/'21","                    $stock = htmlspecialchars($row['在庫数']);","                    ","                    // 購入した商品画像取得　修正箇所　12/2/'21","                    $image = $row['商品画像'];","                    ","                     // 購入した商品価格取得　修正箇所　12/2/'21","                    $price = $row['価格'];","                    ","                }","                ","                // 公開ステータスが非公開の場合購入できない　修正箇所　12/2/'21","                if($status === '0'){","                        ","                    print '現在購入できません';","                        ","                }else{","                        ","                    // おつり計算","                    $charge = $_POST['money'] - $price;","                        ","                    // 在庫数が0個以下の場合購入できない　修正箇所　12/2/'21    ","                    if($stock <= 0){","                        ","                        print '売り切れました！';","                        ","                    }else{","                ","                        // 現在の在庫数から一つひく","                        $stock = $stock - 1;","                        ","                        // 投入金額 - 価格　< 0　の時","                        if($charge < 0){","                            print 'お金が足りません';","                        }else{","                    ","                        // 購入履歴表(drink_history_table)に購入日追加","                        $tohistory_sql = \"INSERT INTO drink_history_table (ドリンクID,購入日) VALUES($drink_id,'$date')\";","                            if(!$result = mysqli_query($link,$tohistory_sql)){","                                $err_msg[] = '購入日追加失敗';","                            }","                        ","                        // 在庫管理表(drink_stock_table)の更新日を更新","                        $tostock_date_sql = \"UPDATE drink_stock_table SET 更新日 = '$date' WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_date_sql)){","                                $err_msg[] = '在庫表更新日更新失敗';","                            }","                            ","                        // 在庫管理表(drink_stock_table)の在庫から一つ引いた数で更新","                        $tostock_stock_sql = \"UPDATE drink_stock_table SET 在庫数 = $stock WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_stock_sql)){","                                $err_msg[] = '在庫数更新失敗';","                                ","                            }","                    ","                        // 結果の表示","                        print '<img src=\"./image/'.$image.'\">';","                        print '<p>がしゃん!['.$drink_name.']が買えました！</p>';","                        print '<p>おつりは['.$charge.'円]です</p>';","                        ","                        }","                    }","                }","            }else{","                $err_msg[] = \"商品情報取得失敗\";","            }","            ","            // sqlでエラーがなければコミット","            if(count($err_msg) === 0){","                mysqli_commit($link);","            }else {","                mysqli_rollback($link);","            }","            ","            // 接続を閉じる","            mysqli_close($link);","        }else{","            $err_msg[] = 'error:' . mysqli_connect_error();","        }","       ","    }","    ?>","        ","        ","        ","    </body>","    <footer>","        <a href=\"index.php\">戻る</a>","    </footer>","</html>"],"id":27}],[{"start":{"row":5,"column":34},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":28}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":29}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":8},"action":"insert","lines":["入力チェック関数"],"id":30}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":3},"action":"insert","lines":["// "],"id":31}],[{"start":{"row":7,"column":11},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":32}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":["f"],"id":33},{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"insert","lines":["u"]},{"start":{"row":8,"column":2},"end":{"row":8,"column":3},"action":"insert","lines":["n"]}],[{"start":{"row":8,"column":2},"end":{"row":8,"column":3},"action":"remove","lines":["n"],"id":34},{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"remove","lines":["u"]},{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"remove","lines":["f"]}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":["b"],"id":35},{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"insert","lines":["u"]},{"start":{"row":8,"column":2},"end":{"row":8,"column":3},"action":"insert","lines":["y"]},{"start":{"row":8,"column":3},"end":{"row":8,"column":4},"action":"insert","lines":["e"]},{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"insert","lines":["r"]}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":["]"],"id":36}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"remove","lines":["]"],"id":37}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":["_"],"id":38}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":6},"action":"remove","lines":["buyer_"],"id":39},{"start":{"row":8,"column":0},"end":{"row":8,"column":16},"action":"insert","lines":["buyer_inputcheck"]}],[{"start":{"row":8,"column":16},"end":{"row":8,"column":18},"action":"insert","lines":["()"],"id":40}],[{"start":{"row":8,"column":18},"end":{"row":8,"column":19},"action":"insert","lines":[";"],"id":41}],[{"start":{"row":8,"column":19},"end":{"row":9,"column":0},"action":"insert","lines":["",""],"id":42},{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":6},"action":"insert","lines":["データベース"],"id":43},{"start":{"row":10,"column":6},"end":{"row":10,"column":8},"action":"insert","lines":["接続"]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":3},"action":"insert","lines":["// "],"id":44}],[{"start":{"row":10,"column":11},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":45}],[{"start":{"row":11,"column":0},"end":{"row":11,"column":1},"action":"insert","lines":["$"],"id":46},{"start":{"row":11,"column":1},"end":{"row":11,"column":2},"action":"insert","lines":["p"]},{"start":{"row":11,"column":2},"end":{"row":11,"column":3},"action":"insert","lines":["d"]},{"start":{"row":11,"column":3},"end":{"row":11,"column":4},"action":"insert","lines":["o"]}],[{"start":{"row":11,"column":4},"end":{"row":11,"column":5},"action":"insert","lines":[" "],"id":47},{"start":{"row":11,"column":5},"end":{"row":11,"column":6},"action":"insert","lines":["="]}],[{"start":{"row":11,"column":6},"end":{"row":11,"column":7},"action":"insert","lines":[" "],"id":48}],[{"start":{"row":11,"column":7},"end":{"row":11,"column":8},"action":"insert","lines":["g"],"id":49},{"start":{"row":11,"column":8},"end":{"row":11,"column":9},"action":"insert","lines":["e"]},{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"insert","lines":["t"]}],[{"start":{"row":11,"column":7},"end":{"row":11,"column":10},"action":"remove","lines":["get"],"id":50},{"start":{"row":11,"column":7},"end":{"row":11,"column":21},"action":"insert","lines":["get_db_connect"]}],[{"start":{"row":11,"column":21},"end":{"row":11,"column":22},"action":"insert","lines":[";"],"id":51}],[{"start":{"row":11,"column":22},"end":{"row":12,"column":0},"action":"insert","lines":["",""],"id":52},{"start":{"row":12,"column":0},"end":{"row":13,"column":0},"action":"insert","lines":["",""]},{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":15,"column":0},"action":"insert","lines":["",""]},{"start":{"row":15,"column":0},"end":{"row":16,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":16,"column":0},"end":{"row":182,"column":7},"action":"insert","lines":["<?php","$regexp_price = '/^[0-9]+$/';   //半角数字の正規表現","","$host = 'localhost';            // データベースのホスト名","$username = 'codecamp49497';    // MySQLのユーザ名","$passwd   = 'codecamp49497';    // MySQLのパスワード","$dbname   = 'codecamp49497';    // データベース名","$link = mysqli_connect($host, $username, $passwd, $dbname);","","// 変数初期化","$drink_id = '';","$post_err = [];","$err_msg = [];","?>","<!DOCTYPE html>","<html lang=\"ja\">","    <body>","        <h1>自動販売機結果</h1>","    <?php","    ","    // 投入金額のエラー","    ","    // 投入金額が入力されていない","    if(!$_POST['money']){","        print '<p>投入金額を入力してください</p>';","        $post_err[] = '投入金額を入力してください';","    }else if(!preg_match($regexp_price,$_POST['money'])){","        // 投入金額が正規表現外","        print  \"<p>投入金額は半角数字を入力してください</p>\";","        $post_err[] = \"投入金額は半角数字を入力してください\";","    }else if($_POST['money'] > 10000){","        // 投入金額が１万以上","        print \"<p>投入金額は1万円以下にしてください</p>\";","        $post_err[] = \"投入金額は1万円以下にしてください\";","    }","    ","    // 購入商品が選択されていないときのエラー","    if(!$_POST['drink_id']){","        print '<p>購入する商品を選択してください</p>';","        $post_err[] = '購入する商品を選択してください';","    }","    ","    // 投入金額と選択商品にエラーがないとき","    if(count($post_err) === 0){","        ","        // 現在時刻を取得","        $date = date('Y-m-d H:i:s');","        ","        // ドリンクid取得","        $drink_id = $_POST['drink_id'];","        ","         // トランザクション開始","        mysqli_autocommit($link, false);","        ","        ","        ","        if($link){","            ","            // 文字コードセット","            mysqli_set_charset($link, 'UTF8');","            ","            // 購入した商品情報取得のためのクエリ","            $sql = \"SELECT drink_details.ドリンクid,ドリンク名,商品画像,価格,在庫数,公開ステータス FROM drink_details JOIN drink_stock_table ON drink_details.ドリンクid = drink_stock_table.ドリンクid WHERE drink_details.ドリンクid = '$drink_id'\";","            ","            if($result = mysqli_query($link,$sql)){","                // 確認用","                // var_dump($drink_id);","                ","                // 結果を一行取り出す","                while($row = mysqli_fetch_assoc($result)){","                    ","                    // 購入したドリンク名取得","                    $drink_name = htmlspecialchars($row['ドリンク名']);","                    ","                    // 購入したドリンクのステータス取得　修正箇所　12/2/'21","                    $status = htmlspecialchars($row['公開ステータス']);","                    ","                    // 購入したドリンクの在庫数取得　修正箇所　12/2/'21","                    $stock = htmlspecialchars($row['在庫数']);","                    ","                    // 購入した商品画像取得　修正箇所　12/2/'21","                    $image = $row['商品画像'];","                    ","                     // 購入した商品価格取得　修正箇所　12/2/'21","                    $price = $row['価格'];","                    ","                }","                ","                // 公開ステータスが非公開の場合購入できない　修正箇所　12/2/'21","                if($status === '0'){","                        ","                    print '現在購入できません';","                        ","                }else{","                        ","                    // おつり計算","                    $charge = $_POST['money'] - $price;","                        ","                    // 在庫数が0個以下の場合購入できない　修正箇所　12/2/'21    ","                    if($stock <= 0){","                        ","                        print '売り切れました！';","                        ","                    }else{","                ","                        // 現在の在庫数から一つひく","                        $stock = $stock - 1;","                        ","                        // 投入金額 - 価格　< 0　の時","                        if($charge < 0){","                            print 'お金が足りません';","                        }else{","                    ","                        // 購入履歴表(drink_history_table)に購入日追加","                        $tohistory_sql = \"INSERT INTO drink_history_table (ドリンクID,購入日) VALUES($drink_id,'$date')\";","                            if(!$result = mysqli_query($link,$tohistory_sql)){","                                $err_msg[] = '購入日追加失敗';","                            }","                        ","                        // 在庫管理表(drink_stock_table)の更新日を更新","                        $tostock_date_sql = \"UPDATE drink_stock_table SET 更新日 = '$date' WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_date_sql)){","                                $err_msg[] = '在庫表更新日更新失敗';","                            }","                            ","                        // 在庫管理表(drink_stock_table)の在庫から一つ引いた数で更新","                        $tostock_stock_sql = \"UPDATE drink_stock_table SET 在庫数 = $stock WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_stock_sql)){","                                $err_msg[] = '在庫数更新失敗';","                                ","                            }","                    ","                        // 結果の表示","                        print '<img src=\"./image/'.$image.'\">';","                        print '<p>がしゃん!['.$drink_name.']が買えました！</p>';","                        print '<p>おつりは['.$charge.'円]です</p>';","                        ","                        }","                    }","                }","            }else{","                $err_msg[] = \"商品情報取得失敗\";","            }","            ","            // sqlでエラーがなければコミット","            if(count($err_msg) === 0){","                mysqli_commit($link);","            }else {","                mysqli_rollback($link);","            }","            ","            // 接続を閉じる","            mysqli_close($link);","        }else{","            $err_msg[] = 'error:' . mysqli_connect_error();","        }","       ","    }","    ?>","        ","        ","        ","    </body>","    <footer>","        <a href=\"index.php\">戻る</a>","    </footer>","</html>"],"id":53}],[{"start":{"row":182,"column":6},"end":{"row":182,"column":7},"action":"remove","lines":[">"],"id":54},{"start":{"row":182,"column":5},"end":{"row":182,"column":6},"action":"remove","lines":["l"]},{"start":{"row":182,"column":4},"end":{"row":182,"column":5},"action":"remove","lines":["m"]},{"start":{"row":182,"column":3},"end":{"row":182,"column":4},"action":"remove","lines":["t"]},{"start":{"row":182,"column":2},"end":{"row":182,"column":3},"action":"remove","lines":["h"]},{"start":{"row":182,"column":1},"end":{"row":182,"column":2},"action":"remove","lines":["/"]},{"start":{"row":182,"column":0},"end":{"row":182,"column":1},"action":"remove","lines":["<"]},{"start":{"row":181,"column":13},"end":{"row":182,"column":0},"action":"remove","lines":["",""]},{"start":{"row":181,"column":12},"end":{"row":181,"column":13},"action":"remove","lines":[">"]},{"start":{"row":181,"column":11},"end":{"row":181,"column":12},"action":"remove","lines":["r"]},{"start":{"row":181,"column":10},"end":{"row":181,"column":11},"action":"remove","lines":["e"]},{"start":{"row":181,"column":9},"end":{"row":181,"column":10},"action":"remove","lines":["t"]},{"start":{"row":181,"column":8},"end":{"row":181,"column":9},"action":"remove","lines":["o"]},{"start":{"row":181,"column":7},"end":{"row":181,"column":8},"action":"remove","lines":["o"]},{"start":{"row":181,"column":6},"end":{"row":181,"column":7},"action":"remove","lines":["f"]},{"start":{"row":181,"column":5},"end":{"row":181,"column":6},"action":"remove","lines":["/"]},{"start":{"row":181,"column":4},"end":{"row":181,"column":5},"action":"remove","lines":["<"]},{"start":{"row":181,"column":0},"end":{"row":181,"column":4},"action":"remove","lines":["    "]},{"start":{"row":180,"column":34},"end":{"row":181,"column":0},"action":"remove","lines":["",""]},{"start":{"row":180,"column":33},"end":{"row":180,"column":34},"action":"remove","lines":[">"]},{"start":{"row":180,"column":32},"end":{"row":180,"column":33},"action":"remove","lines":["a"]},{"start":{"row":180,"column":31},"end":{"row":180,"column":32},"action":"remove","lines":["/"]},{"start":{"row":180,"column":30},"end":{"row":180,"column":31},"action":"remove","lines":["<"]},{"start":{"row":180,"column":29},"end":{"row":180,"column":30},"action":"remove","lines":["る"]},{"start":{"row":180,"column":28},"end":{"row":180,"column":29},"action":"remove","lines":["戻"]},{"start":{"row":180,"column":27},"end":{"row":180,"column":28},"action":"remove","lines":[">"]},{"start":{"row":180,"column":26},"end":{"row":180,"column":27},"action":"remove","lines":["\""]},{"start":{"row":180,"column":25},"end":{"row":180,"column":26},"action":"remove","lines":["p"]},{"start":{"row":180,"column":24},"end":{"row":180,"column":25},"action":"remove","lines":["h"]},{"start":{"row":180,"column":23},"end":{"row":180,"column":24},"action":"remove","lines":["p"]},{"start":{"row":180,"column":22},"end":{"row":180,"column":23},"action":"remove","lines":["."]},{"start":{"row":180,"column":21},"end":{"row":180,"column":22},"action":"remove","lines":["x"]},{"start":{"row":180,"column":20},"end":{"row":180,"column":21},"action":"remove","lines":["e"]},{"start":{"row":180,"column":19},"end":{"row":180,"column":20},"action":"remove","lines":["d"]},{"start":{"row":180,"column":18},"end":{"row":180,"column":19},"action":"remove","lines":["n"]},{"start":{"row":180,"column":17},"end":{"row":180,"column":18},"action":"remove","lines":["i"]},{"start":{"row":180,"column":16},"end":{"row":180,"column":17},"action":"remove","lines":["\""]},{"start":{"row":180,"column":15},"end":{"row":180,"column":16},"action":"remove","lines":["="]},{"start":{"row":180,"column":14},"end":{"row":180,"column":15},"action":"remove","lines":["f"]},{"start":{"row":180,"column":13},"end":{"row":180,"column":14},"action":"remove","lines":["e"]},{"start":{"row":180,"column":12},"end":{"row":180,"column":13},"action":"remove","lines":["r"]},{"start":{"row":180,"column":11},"end":{"row":180,"column":12},"action":"remove","lines":["h"]},{"start":{"row":180,"column":10},"end":{"row":180,"column":11},"action":"remove","lines":[" "]},{"start":{"row":180,"column":9},"end":{"row":180,"column":10},"action":"remove","lines":["a"]},{"start":{"row":180,"column":8},"end":{"row":180,"column":9},"action":"remove","lines":["<"]},{"start":{"row":180,"column":4},"end":{"row":180,"column":8},"action":"remove","lines":["    "]},{"start":{"row":180,"column":0},"end":{"row":180,"column":4},"action":"remove","lines":["    "]},{"start":{"row":179,"column":12},"end":{"row":180,"column":0},"action":"remove","lines":["",""]},{"start":{"row":179,"column":11},"end":{"row":179,"column":12},"action":"remove","lines":[">"]},{"start":{"row":179,"column":10},"end":{"row":179,"column":11},"action":"remove","lines":["r"]},{"start":{"row":179,"column":9},"end":{"row":179,"column":10},"action":"remove","lines":["e"]},{"start":{"row":179,"column":8},"end":{"row":179,"column":9},"action":"remove","lines":["t"]}],[{"start":{"row":179,"column":7},"end":{"row":179,"column":8},"action":"remove","lines":["o"],"id":56},{"start":{"row":179,"column":6},"end":{"row":179,"column":7},"action":"remove","lines":["o"]},{"start":{"row":179,"column":5},"end":{"row":179,"column":6},"action":"remove","lines":["f"]},{"start":{"row":179,"column":4},"end":{"row":179,"column":5},"action":"remove","lines":["<"]}],[{"start":{"row":179,"column":4},"end":{"row":182,"column":7},"action":"insert","lines":["<footer>","        <a href=\"index.php\">戻る</a>","    </footer>","</html>"],"id":57}],[{"start":{"row":30,"column":2},"end":{"row":182,"column":7},"action":"remove","lines":["DOCTYPE html>","<html lang=\"ja\">","    <body>","        <h1>自動販売機結果</h1>","    <?php","    ","    // 投入金額のエラー","    ","    // 投入金額が入力されていない","    if(!$_POST['money']){","        print '<p>投入金額を入力してください</p>';","        $post_err[] = '投入金額を入力してください';","    }else if(!preg_match($regexp_price,$_POST['money'])){","        // 投入金額が正規表現外","        print  \"<p>投入金額は半角数字を入力してください</p>\";","        $post_err[] = \"投入金額は半角数字を入力してください\";","    }else if($_POST['money'] > 10000){","        // 投入金額が１万以上","        print \"<p>投入金額は1万円以下にしてください</p>\";","        $post_err[] = \"投入金額は1万円以下にしてください\";","    }","    ","    // 購入商品が選択されていないときのエラー","    if(!$_POST['drink_id']){","        print '<p>購入する商品を選択してください</p>';","        $post_err[] = '購入する商品を選択してください';","    }","    ","    // 投入金額と選択商品にエラーがないとき","    if(count($post_err) === 0){","        ","        // 現在時刻を取得","        $date = date('Y-m-d H:i:s');","        ","        // ドリンクid取得","        $drink_id = $_POST['drink_id'];","        ","         // トランザクション開始","        mysqli_autocommit($link, false);","        ","        ","        ","        if($link){","            ","            // 文字コードセット","            mysqli_set_charset($link, 'UTF8');","            ","            // 購入した商品情報取得のためのクエリ","            $sql = \"SELECT drink_details.ドリンクid,ドリンク名,商品画像,価格,在庫数,公開ステータス FROM drink_details JOIN drink_stock_table ON drink_details.ドリンクid = drink_stock_table.ドリンクid WHERE drink_details.ドリンクid = '$drink_id'\";","            ","            if($result = mysqli_query($link,$sql)){","                // 確認用","                // var_dump($drink_id);","                ","                // 結果を一行取り出す","                while($row = mysqli_fetch_assoc($result)){","                    ","                    // 購入したドリンク名取得","                    $drink_name = htmlspecialchars($row['ドリンク名']);","                    ","                    // 購入したドリンクのステータス取得　修正箇所　12/2/'21","                    $status = htmlspecialchars($row['公開ステータス']);","                    ","                    // 購入したドリンクの在庫数取得　修正箇所　12/2/'21","                    $stock = htmlspecialchars($row['在庫数']);","                    ","                    // 購入した商品画像取得　修正箇所　12/2/'21","                    $image = $row['商品画像'];","                    ","                     // 購入した商品価格取得　修正箇所　12/2/'21","                    $price = $row['価格'];","                    ","                }","                ","                // 公開ステータスが非公開の場合購入できない　修正箇所　12/2/'21","                if($status === '0'){","                        ","                    print '現在購入できません';","                        ","                }else{","                        ","                    // おつり計算","                    $charge = $_POST['money'] - $price;","                        ","                    // 在庫数が0個以下の場合購入できない　修正箇所　12/2/'21    ","                    if($stock <= 0){","                        ","                        print '売り切れました！';","                        ","                    }else{","                ","                        // 現在の在庫数から一つひく","                        $stock = $stock - 1;","                        ","                        // 投入金額 - 価格　< 0　の時","                        if($charge < 0){","                            print 'お金が足りません';","                        }else{","                    ","                        // 購入履歴表(drink_history_table)に購入日追加","                        $tohistory_sql = \"INSERT INTO drink_history_table (ドリンクID,購入日) VALUES($drink_id,'$date')\";","                            if(!$result = mysqli_query($link,$tohistory_sql)){","                                $err_msg[] = '購入日追加失敗';","                            }","                        ","                        // 在庫管理表(drink_stock_table)の更新日を更新","                        $tostock_date_sql = \"UPDATE drink_stock_table SET 更新日 = '$date' WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_date_sql)){","                                $err_msg[] = '在庫表更新日更新失敗';","                            }","                            ","                        // 在庫管理表(drink_stock_table)の在庫から一つ引いた数で更新","                        $tostock_stock_sql = \"UPDATE drink_stock_table SET 在庫数 = $stock WHERE ドリンクid = '$drink_id'\";","                            if(!$result = mysqli_query($link,$tostock_stock_sql)){","                                $err_msg[] = '在庫数更新失敗';","                                ","                            }","                    ","                        // 結果の表示","                        print '<img src=\"./image/'.$image.'\">';","                        print '<p>がしゃん!['.$drink_name.']が買えました！</p>';","                        print '<p>おつりは['.$charge.'円]です</p>';","                        ","                        }","                    }","                }","            }else{","                $err_msg[] = \"商品情報取得失敗\";","            }","            ","            // sqlでエラーがなければコミット","            if(count($err_msg) === 0){","                mysqli_commit($link);","            }else {","                mysqli_rollback($link);","            }","            ","            // 接続を閉じる","            mysqli_close($link);","        }else{","            $err_msg[] = 'error:' . mysqli_connect_error();","        }","       ","    }","    ?>","        ","        ","        ","    </body>","    <footer>","        <a href=\"index.php\">戻る</a>","    </footer>","</html>"],"id":58}],[{"start":{"row":19,"column":0},"end":{"row":22,"column":42},"action":"remove","lines":["$host = 'localhost';            // データベースのホスト名","$username = 'codecamp49497';    // MySQLのユーザ名","$passwd   = 'codecamp49497';    // MySQLのパスワード","$dbname   = 'codecamp49497';    // データベース名"],"id":59}],[{"start":{"row":20,"column":0},"end":{"row":20,"column":59},"action":"remove","lines":["$link = mysqli_connect($host, $username, $passwd, $dbname);"],"id":60},{"start":{"row":19,"column":0},"end":{"row":20,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":16,"column":4},"end":{"row":16,"column":5},"action":"remove","lines":["p"],"id":61},{"start":{"row":16,"column":3},"end":{"row":16,"column":4},"action":"remove","lines":["h"]},{"start":{"row":16,"column":2},"end":{"row":16,"column":3},"action":"remove","lines":["p"]},{"start":{"row":16,"column":1},"end":{"row":16,"column":2},"action":"remove","lines":["?"]},{"start":{"row":16,"column":0},"end":{"row":16,"column":1},"action":"remove","lines":["<"]}],[{"start":{"row":26,"column":1},"end":{"row":26,"column":2},"action":"remove","lines":["!"],"id":62},{"start":{"row":26,"column":0},"end":{"row":26,"column":1},"action":"remove","lines":["<"]}],[{"start":{"row":13,"column":0},"end":{"row":13,"column":1},"action":"insert","lines":["f"],"id":63},{"start":{"row":13,"column":1},"end":{"row":13,"column":2},"action":"insert","lines":["i"]}],[{"start":{"row":13,"column":1},"end":{"row":13,"column":2},"action":"remove","lines":["i"],"id":64}],[{"start":{"row":13,"column":1},"end":{"row":13,"column":2},"action":"insert","lines":["u"],"id":65},{"start":{"row":13,"column":2},"end":{"row":13,"column":3},"action":"insert","lines":["n"]},{"start":{"row":13,"column":3},"end":{"row":13,"column":4},"action":"insert","lines":["c"]}],[{"start":{"row":13,"column":4},"end":{"row":13,"column":5},"action":"insert","lines":["t"],"id":66},{"start":{"row":13,"column":5},"end":{"row":13,"column":6},"action":"insert","lines":["i"]},{"start":{"row":13,"column":6},"end":{"row":13,"column":7},"action":"insert","lines":["o"]},{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"insert","lines":["n"]}],[{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"remove","lines":["n"],"id":67},{"start":{"row":13,"column":6},"end":{"row":13,"column":7},"action":"remove","lines":["o"]},{"start":{"row":13,"column":5},"end":{"row":13,"column":6},"action":"remove","lines":["i"]},{"start":{"row":13,"column":4},"end":{"row":13,"column":5},"action":"remove","lines":["t"]},{"start":{"row":13,"column":3},"end":{"row":13,"column":4},"action":"remove","lines":["c"]},{"start":{"row":13,"column":2},"end":{"row":13,"column":3},"action":"remove","lines":["n"]},{"start":{"row":13,"column":1},"end":{"row":13,"column":2},"action":"remove","lines":["u"]},{"start":{"row":13,"column":0},"end":{"row":13,"column":1},"action":"remove","lines":["f"]}],[{"start":{"row":11,"column":21},"end":{"row":11,"column":23},"action":"insert","lines":["()"],"id":68}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":["$"],"id":69},{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"insert","lines":["p"]},{"start":{"row":8,"column":2},"end":{"row":8,"column":3},"action":"insert","lines":["o"]},{"start":{"row":8,"column":3},"end":{"row":8,"column":4},"action":"insert","lines":["s"]},{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"insert","lines":["t"]}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":[" "],"id":70}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"remove","lines":[" "],"id":71}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":["_"],"id":72},{"start":{"row":8,"column":6},"end":{"row":8,"column":7},"action":"insert","lines":["e"]},{"start":{"row":8,"column":7},"end":{"row":8,"column":8},"action":"insert","lines":["r"]},{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"insert","lines":["r"]}],[{"start":{"row":8,"column":9},"end":{"row":8,"column":10},"action":"insert","lines":[" "],"id":73},{"start":{"row":8,"column":10},"end":{"row":8,"column":11},"action":"insert","lines":["="]}],[{"start":{"row":8,"column":11},"end":{"row":8,"column":12},"action":"insert","lines":[" "],"id":74}],[{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"insert","lines":["商品情報"],"id":75}],[{"start":{"row":13,"column":4},"end":{"row":13,"column":6},"action":"insert","lines":["変更"],"id":76},{"start":{"row":13,"column":6},"end":{"row":13,"column":8},"action":"insert","lines":["関数"]}],[{"start":{"row":13,"column":0},"end":{"row":13,"column":3},"action":"insert","lines":["// "],"id":77}],[{"start":{"row":13,"column":11},"end":{"row":14,"column":0},"action":"insert","lines":["",""],"id":78},{"start":{"row":14,"column":0},"end":{"row":14,"column":1},"action":"insert","lines":["b"]},{"start":{"row":14,"column":1},"end":{"row":14,"column":2},"action":"insert","lines":["o"]},{"start":{"row":14,"column":2},"end":{"row":14,"column":3},"action":"insert","lines":["u"]}],[{"start":{"row":14,"column":3},"end":{"row":14,"column":4},"action":"insert","lines":["g"],"id":79},{"start":{"row":14,"column":4},"end":{"row":14,"column":5},"action":"insert","lines":["h"]},{"start":{"row":14,"column":5},"end":{"row":14,"column":6},"action":"insert","lines":["t"]}],[{"start":{"row":14,"column":0},"end":{"row":14,"column":6},"action":"remove","lines":["bought"],"id":80},{"start":{"row":14,"column":0},"end":{"row":14,"column":15},"action":"insert","lines":["bought_iteminfo"]}],[{"start":{"row":14,"column":15},"end":{"row":14,"column":17},"action":"insert","lines":["()"],"id":81}],[{"start":{"row":14,"column":16},"end":{"row":14,"column":17},"action":"insert","lines":["$"],"id":82},{"start":{"row":14,"column":17},"end":{"row":14,"column":18},"action":"insert","lines":["p"]},{"start":{"row":14,"column":18},"end":{"row":14,"column":19},"action":"insert","lines":["o"]},{"start":{"row":14,"column":19},"end":{"row":14,"column":20},"action":"insert","lines":["s"]},{"start":{"row":14,"column":20},"end":{"row":14,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":14,"column":16},"end":{"row":14,"column":21},"action":"remove","lines":["$post"],"id":83},{"start":{"row":14,"column":16},"end":{"row":14,"column":25},"action":"insert","lines":["$post_err"]}],[{"start":{"row":14,"column":25},"end":{"row":14,"column":26},"action":"insert","lines":[","],"id":84}],[{"start":{"row":14,"column":26},"end":{"row":14,"column":27},"action":"insert","lines":["$"],"id":85},{"start":{"row":14,"column":27},"end":{"row":14,"column":28},"action":"insert","lines":["p"]},{"start":{"row":14,"column":28},"end":{"row":14,"column":29},"action":"insert","lines":["d"]},{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"insert","lines":["o"]}],[{"start":{"row":14,"column":31},"end":{"row":14,"column":32},"action":"insert","lines":["{"],"id":86}],[{"start":{"row":14,"column":31},"end":{"row":14,"column":32},"action":"remove","lines":["{"],"id":87}],[{"start":{"row":14,"column":31},"end":{"row":14,"column":32},"action":"insert","lines":[";"],"id":88}],[{"start":{"row":16,"column":0},"end":{"row":16,"column":1},"action":"insert","lines":["i"],"id":89},{"start":{"row":16,"column":1},"end":{"row":16,"column":2},"action":"insert","lines":["n"]},{"start":{"row":16,"column":2},"end":{"row":16,"column":3},"action":"insert","lines":["c"]},{"start":{"row":16,"column":3},"end":{"row":16,"column":4},"action":"insert","lines":["l"]},{"start":{"row":16,"column":4},"end":{"row":16,"column":5},"action":"insert","lines":["u"]},{"start":{"row":16,"column":5},"end":{"row":16,"column":6},"action":"insert","lines":["d"]},{"start":{"row":16,"column":6},"end":{"row":16,"column":7},"action":"insert","lines":["e"]}],[{"start":{"row":16,"column":0},"end":{"row":16,"column":7},"action":"remove","lines":["include"],"id":90},{"start":{"row":16,"column":0},"end":{"row":16,"column":12},"action":"insert","lines":["include_once"]}],[{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"insert","lines":[" "],"id":91}],[{"start":{"row":16,"column":13},"end":{"row":16,"column":15},"action":"insert","lines":["''"],"id":92}],[{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"insert","lines":["t"],"id":93},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"insert","lines":["o"]},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"insert","lines":["o"]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"insert","lines":["l"]}],[{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"remove","lines":["l"],"id":94},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"remove","lines":["o"]},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"remove","lines":["o"]},{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"remove","lines":["t"]}],[{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"insert","lines":["r"],"id":95},{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"insert","lines":["e"]},{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"insert","lines":["s"]},{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"insert","lines":["u"]},{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"insert","lines":["l"]},{"start":{"row":16,"column":19},"end":{"row":16,"column":20},"action":"insert","lines":["t"]}],[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":["_"],"id":96},{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"insert","lines":["v"]},{"start":{"row":16,"column":22},"end":{"row":16,"column":23},"action":"insert","lines":["i"]},{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"insert","lines":["e"]},{"start":{"row":16,"column":24},"end":{"row":16,"column":25},"action":"insert","lines":["w"]}],[{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"insert","lines":["/"],"id":97}],[{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"remove","lines":["/"],"id":98}],[{"start":{"row":16,"column":25},"end":{"row":16,"column":26},"action":"insert","lines":["."],"id":99},{"start":{"row":16,"column":26},"end":{"row":16,"column":27},"action":"insert","lines":["p"]},{"start":{"row":16,"column":27},"end":{"row":16,"column":28},"action":"insert","lines":["h"]},{"start":{"row":16,"column":28},"end":{"row":16,"column":29},"action":"insert","lines":["p"]}],[{"start":{"row":16,"column":30},"end":{"row":16,"column":31},"action":"insert","lines":[";"],"id":100}],[{"start":{"row":22,"column":0},"end":{"row":26,"column":2},"action":"remove","lines":["// 変数初期化","$drink_id = '';","$post_err = [];","$err_msg = [];","?>"],"id":101}],[{"start":{"row":20,"column":0},"end":{"row":20,"column":1},"action":"insert","lines":["$"],"id":102},{"start":{"row":20,"column":1},"end":{"row":20,"column":2},"action":"insert","lines":["p"]},{"start":{"row":20,"column":2},"end":{"row":20,"column":3},"action":"insert","lines":["d"]},{"start":{"row":20,"column":3},"end":{"row":20,"column":4},"action":"insert","lines":["o"]}],[{"start":{"row":20,"column":4},"end":{"row":20,"column":5},"action":"insert","lines":[" "],"id":103},{"start":{"row":20,"column":5},"end":{"row":20,"column":6},"action":"insert","lines":["="]}],[{"start":{"row":20,"column":6},"end":{"row":20,"column":7},"action":"insert","lines":[" "],"id":104},{"start":{"row":20,"column":7},"end":{"row":20,"column":8},"action":"insert","lines":["u"]}],[{"start":{"row":20,"column":7},"end":{"row":20,"column":8},"action":"remove","lines":["u"],"id":105}],[{"start":{"row":20,"column":7},"end":{"row":20,"column":8},"action":"insert","lines":["n"],"id":106},{"start":{"row":20,"column":8},"end":{"row":20,"column":9},"action":"insert","lines":["u"]},{"start":{"row":20,"column":9},"end":{"row":20,"column":10},"action":"insert","lines":["l"]},{"start":{"row":20,"column":10},"end":{"row":20,"column":11},"action":"insert","lines":["l"]},{"start":{"row":20,"column":11},"end":{"row":20,"column":12},"action":"insert","lines":[";"]}],[{"start":{"row":18,"column":0},"end":{"row":18,"column":43},"action":"remove","lines":["$regexp_price = '/^[0-9]+$/';   //半角数字の正規表現"],"id":107},{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"remove","lines":["",""],"id":108}],[{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"insert","lines":["",""],"id":109}]]},"timestamp":1638505493718}