{"changed":true,"filter":false,"title":"tool_model.php","tooltip":"/include/tool_model.php","value":"<?php\n// 文字入力チェック関数\nfunction input_charcheck(){\n    if(isset($_POST['new_name']) && isset($_POST['new_price']) && isset($_POST['new_stock']) && isset($_POST['new_status'])){\n    \n        // 変数に代入\n        $new_status = $_POST['new_status'];\n        \n        // ＿POSTが空白の場合のエラー\n        if($_POST['new_name'] === \"\"){\n        //   名前が空白\n            $input_err[] = \"名前を入力してください<br>\";\n        }else{\n            $new_name = $_POST['new_name'];\n        }\n       \n        if($_POST['new_price'] === \"\"){\n            //   値段が空白\n            $input_err[] = \"値段を入力してください<br>\";\n            \n        }else{\n            \n           if(!preg_match($regexp_price,$_POST['new_price'])){\n               //   値段が空白ではないが半角数字ではない\n               $input_err[] = \"値段は半角数字を入力してください<br>\";\n           }else if($new_price > 10000){\n               //   値段が空白ではなく半角数字でもあるが１万円以上\n               $input_err[] = \"値段は1万円以下にして下さい<br>\";\n           }else{\n               $new_price = $_POST['new_price'];\n           }\n           \n        }\n        \n       if($_POST['new_stock'] === \"\"){\n        //   個数が空白\n            $input_err[] = \"個数を入力してください<br>\";\n       }else{\n           \n           if(!preg_match($regexp_stock,$_POST['new_stock'])){\n            //   個数が空白ではないが半角数字\n            $input_err[] = \"個数は半角数字を入力してください<br>\";\n           }else{\n            $new_stock = $_POST['new_stock'];\n           }\n           \n       }   \n            \n       if(empty($_FILES['new_img']['name'])){\n        //   ファイル名が空白\n           $input_err[] = \"ファイルを選択してください<br>\";\n       }else{\n           if(preg_match($regexp_file,$_FILES['new_img']['name'])){\n         \n        //  保存先のパスとブラウザ上に一時保存された画像名を結合\n           $upload = $uploader . basename($_FILES['new_img']['name']);\n        //   var_dump($upload);\n        \n        //   アップロードされた画像をファイルに保存\n           if(move_uploaded_file($_FILES['new_img']['tmp_name'],$upload) !== TRUE){\n               $err_msg[] = '保存失敗';\n           };\n           \n        //   画像名を変数に代入\n           $filename = basename($_FILES['new_img']['name']);\n        //   確認用\n        //   var_dump($filename);\n           }else{\n               $input_err[] = \"ファイル形式が異なります。画像ファイルはJPEG又はPNGのみ利用可能です。\";\n           }\n       } \n    }\n}\n\nfunction get_db(){\n    try { \n            // pdoによるMYSQLへの接続\n            $pdo = new PDO('mysql:host=localhost;dbname=codecamp49497;charset=utf-8;',$username,$passwd);\n            $pdo-> setAttribute(PDO::ATTRE_ERRMODE,PDO::ERRMODE_EXCEPTION);\n            \n            // トランザクション開始\n            $pdo->beginTransaction();\n        }\n}\n","undoManager":{"mark":10,"position":19,"stack":[[{"start":{"row":0,"column":0},"end":{"row":73,"column":1},"action":"insert","lines":[" // 文字入力チェック関数"," function input_charcheck(){","    if(isset($_POST['new_name']) && isset($_POST['new_price']) && isset($_POST['new_stock']) && isset($_POST['new_status'])){","    ","        // 変数に代入","        $new_status = $_POST['new_status'];","        ","        //  mysqli トランザクション開始","        //  mysqli_autocommit($link, false);","            ","         // ＿POSTが空白の場合のエラー","        if($_POST['new_name'] === \"\"){","        //   名前が空白","            $input_err[] = \"名前を入力してください<br>\";","        }else{","            $new_name = $_POST['new_name'];","        }","       ","        if($_POST['new_price'] === \"\"){","            //   値段が空白","            $input_err[] = \"値段を入力してください<br>\";","            ","        }else{","            ","           if(!preg_match($regexp_price,$_POST['new_price'])){","               //   値段が空白ではないが半角数字ではない","               $input_err[] = \"値段は半角数字を入力してください<br>\";","           }else if($new_price > 10000){","               //   値段が空白ではなく半角数字でもあるが１万円以上","               $input_err[] = \"値段は1万円以下にして下さい<br>\";","           }else{","               $new_price = $_POST['new_price'];","           }","           ","        }","        ","       if($_POST['new_stock'] === \"\"){","        //   個数が空白","            $input_err[] = \"個数を入力してください<br>\";","       }else{","           ","           if(!preg_match($regexp_stock,$_POST['new_stock'])){","            //   個数が空白ではないが半角数字","            $input_err[] = \"個数は半角数字を入力してください<br>\";","           }else{","            $new_stock = $_POST['new_stock'];","           }","           ","       }   ","            ","       if(empty($_FILES['new_img']['name'])){","        //   ファイル名が空白","           $input_err[] = \"ファイルを選択してください<br>\";","       }else{","           if(preg_match($regexp_file,$_FILES['new_img']['name'])){","         ","        //  保存先のパスとブラウザ上に一時保存された画像名を結合","           $upload = $uploader . basename($_FILES['new_img']['name']);","        //   var_dump($upload);","        ","        //   アップロードされた画像をファイルに保存","           if(move_uploaded_file($_FILES['new_img']['tmp_name'],$upload) !== TRUE){","               $err_msg[] = '保存失敗';","           };","           ","        //   画像名を変数に代入","           $filename = basename($_FILES['new_img']['name']);","        //   確認用","        //   var_dump($filename);","           }else{","               $input_err[] = \"ファイル形式が異なります。画像ファイルはJPEG又はPNGのみ利用可能です。\";","           }","       } ","}"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":[" "],"id":3},{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"]},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"],"id":4},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":5}],[{"start":{"row":74,"column":1},"end":{"row":75,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":75,"column":0},"end":{"row":75,"column":1},"action":"insert","lines":["}"]}],[{"start":{"row":74,"column":0},"end":{"row":74,"column":4},"action":"insert","lines":["    "],"id":7}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":1},"action":"remove","lines":[" "],"id":8}],[{"start":{"row":8,"column":7},"end":{"row":9,"column":44},"action":"remove","lines":[" //  mysqli トランザクション開始","        //  mysqli_autocommit($link, false);"],"id":9}],[{"start":{"row":9,"column":4},"end":{"row":9,"column":8},"action":"remove","lines":["    "],"id":10},{"start":{"row":9,"column":0},"end":{"row":9,"column":4},"action":"remove","lines":["    "]},{"start":{"row":8,"column":7},"end":{"row":9,"column":4},"action":"remove","lines":["","    "]},{"start":{"row":8,"column":6},"end":{"row":8,"column":7},"action":"remove","lines":[" "]},{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"remove","lines":[" "]},{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"remove","lines":[" "]}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":4},"action":"remove","lines":["    "],"id":11},{"start":{"row":7,"column":8},"end":{"row":8,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":8,"column":8},"end":{"row":8,"column":9},"action":"remove","lines":[" "],"id":12}],[{"start":{"row":72,"column":1},"end":{"row":73,"column":0},"action":"insert","lines":["",""],"id":13},{"start":{"row":73,"column":0},"end":{"row":74,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":74,"column":0},"end":{"row":83,"column":5},"action":"insert","lines":[" function get_db(){","        try { ","            // pdoによるMYSQLへの接続","            $pdo = new PDO('mysql:host=localhost;dbname=codecamp49497;charset=utf-8;',$username,$passwd);","            $pdo-> setAttribute(PDO::ATTRE_ERRMODE,PDO::ERRMODE_EXCEPTION);","            ","            // トランザクション開始","            $pdo->beginTransaction();","        }","    }"],"id":14}],[{"start":{"row":74,"column":0},"end":{"row":74,"column":1},"action":"remove","lines":[" "],"id":15}],[{"start":{"row":75,"column":4},"end":{"row":75,"column":8},"action":"remove","lines":["    "],"id":16}],[{"start":{"row":83,"column":5},"end":{"row":84,"column":0},"action":"insert","lines":["",""],"id":17},{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":4},"action":"remove","lines":["    "],"id":18}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":1},"action":"insert","lines":["}"],"id":19}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":1},"action":"remove","lines":["}"],"id":20}],[{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "],"id":21}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":79,"column":12},"end":{"row":79,"column":12},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1638247800989}