{"filter":false,"title":"function.php","tooltip":"/include/model/function.php","undoManager":{"mark":10,"position":9,"stack":[[{"start":{"row":0,"column":0},"end":{"row":129,"column":1},"action":"remove","lines":["<?php"," ","/**","* 税込み価格へ変換する(端数は切り上げ)","* @param str  $price 税抜き価格","* @return str 税込み価格","*/","function price_before_tax($price) {","    return floor($price * TAX);","}"," ","/**","* 商品の値段を税込みに変換する(配列)","* @param array  $assoc_array 税抜き商品一覧配列データ","* @return array 税込み商品一覧配列データ","*/","function price_before_tax_assoc_array($assoc_array) {"," ","    foreach ($assoc_array as $key => $value) {","        // 税込み価格へ変換(端数は切り上げ)","        $assoc_array[$key]['price'] = price_before_tax($assoc_array[$key]['price']);","    }"," ","    return $assoc_array;"," ","}"," ","/**","* 特殊文字をHTMLエンティティに変換する","* @param str  $str 変換前文字","* @return str 変換後文字","*/","function entity_str($str) {","    return htmlspecialchars($str, ENT_QUOTES, HTML_CHARACTER_SET);","}"," ","/**","* 特殊文字をHTMLエンティティに変換する(2次元配列の値)","* @param array  $assoc_array 変換前配列","* @return array 変換後配列","*/","function entity_assoc_array($assoc_array) {"," ","    foreach ($assoc_array as $key => $value) {"," ","        foreach ($value as $keys => $values) {","            // 特殊文字をHTMLエンティティに変換","            $assoc_array[$key][$keys] = entity_str($values);","        }"," ","    }"," ","    return $assoc_array;"," ","}"," ","/**","* DBハンドルを取得","* @return obj $link DBハンドル","*/","function get_db_connect() {"," ","    // コネクション取得","    if (!$link = mysqli_connect(DB_HOST, DB_USER, DB_PASSWD, DB_NAME)) {","        die('error: ' . mysqli_connect_error());","    }"," ","    // 文字コードセット","    mysqli_set_charset($link, DB_CHARACTER_SET);"," ","    return $link;","}"," ","/**","* DBとのコネクション切断","* @param obj $link DBハンドル","*/","function close_db_connect($link) {","    // 接続を閉じる","    mysqli_close($link);","}"," ","/**","* クエリを実行しその結果を配列で取得する","*","* @param obj  $link DBハンドル","* @param str  $sql SQL文","* @return array 結果配列データ","*/","function get_as_array($link, $sql) {"," ","    // 返却用配列","    $data = [];"," ","    // クエリを実行する","    if ($result = mysqli_query($link, $sql)) {"," ","        if (mysqli_num_rows($result) > 0) {"," ","            // １件ずつ取り出す","            while ($row = mysqli_fetch_assoc($result)) {","                $data[] = $row;","            }"," ","        }"," ","        // 結果セットを開放","        mysqli_free_result($result);"," ","    }"," ","    return $data;"," ","}"," ","/**","* 商品の一覧を取得する","*","* @param obj $link DBハンドル","* @return array 商品一覧配列データ","*/","function get_goods_table_list($link) {"," ","    // SQL生成","    $sql = 'SELECT goods_name, price FROM goods_table';"," ","    // クエリ実行","    return get_as_array($link, $sql);"," ","}"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":1},"action":"insert","lines":["/**","* insertを実行する","*","* @param obj $link DBハンドル","* @param str SQL文","* @return bool","*/","function insert_db($link, $sql) {","   // クエリを実行する","   if (mysqli_query($link, $sql) === TRUE) {","       return TRUE;","   } else {","       return FALSE;","   }","}","/**","* 新規商品を追加する","*","* @param obj $link DBハンドル","* @param str $goods_name 商品名","* @param int $price 価格","* @return bool","*/","function insert_goods_table($link, $goods_name, $price) {","   // SQL生成","   $sql = 'INSERT INTO goods_table(goods_name, price) VALUES(\\'' . $goods_name . '\\', ' . $price . ')';","   // クエリ実行","   return insert_db($link, $sql);","}","/**","* リクエストメソッドを取得","* @return str GET/POST/PUTなど","*/","function get_request_method() {","   return $_SERVER['REQUEST_METHOD'];","}","/**","* POSTデータを取得","* @param str $key 配列キー","* @return str POST値","*/","function get_post_data($key) {","   $str = '';","   if (isset($_POST[$key]) === TRUE) {","       $str = $_POST[$key];","   }","   return $str;","}"],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":4},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["P"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["H"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["P"]}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"remove","lines":["P"],"id":5},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"remove","lines":["H"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["P"]}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["P"],"id":6},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["H"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["P"]}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"remove","lines":["P"],"id":7},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"remove","lines":["H"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["P"]}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"],"id":8},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":9}],[{"start":{"row":0,"column":5},"end":{"row":129,"column":1},"action":"insert","lines":["<?php"," ","/**","* 税込み価格へ変換する(端数は切り上げ)","* @param str  $price 税抜き価格","* @return str 税込み価格","*/","function price_before_tax($price) {","    return ceil($price * TAX);","}"," ","/**","* 商品の値段を税込みに変換する(配列)","* @param array  $assoc_array 税抜き商品一覧配列データ","* @return array 税込み商品一覧配列データ","*/","function price_before_tax_assoc_array($assoc_array) {"," ","    foreach ($assoc_array as $key => $value) {","        // 税込み価格へ変換(端数は切り上げ)","        $assoc_array[$key]['price'] = price_before_tax($assoc_array[$key]['price']);","    }"," ","    return $assoc_array;"," ","}"," ","/**","* 特殊文字をHTMLエンティティに変換する","* @param str  $str 変換前文字","* @return str 変換後文字","*/","function entity_str($str) {","    return htmlspecialchars($str, ENT_QUOTES, HTML_CHARACTER_SET);","}"," ","/**","* 特殊文字をHTMLエンティティに変換する(2次元配列の値)","* @param array  $assoc_array 変換前配列","* @return array 変換後配列","*/","function entity_assoc_array($assoc_array) {"," ","    foreach ($assoc_array as $key => $value) {"," ","        foreach ($value as $keys => $values) {","            // 特殊文字をHTMLエンティティに変換","            $assoc_array[$key][$keys] = entity_str($values);","        }"," ","    }"," ","    return $assoc_array;"," ","}"," ","/**","* DBハンドルを取得","* @return obj $link DBハンドル","*/","function get_db_connect() {"," ","    // コネクション取得","    if (!$link = mysqli_connect(DB_HOST, DB_USER, DB_PASSWD, DB_NAME)) {","        die('error: ' . mysqli_connect_error());","    }"," ","    // 文字コードセット","    mysqli_set_charset($link, DB_CHARACTER_SET);"," ","    return $link;","}"," ","/**","* DBとのコネクション切断","* @param obj $link DBハンドル","*/","function close_db_connect($link) {","    // 接続を閉じる","    mysqli_close($link);","}"," ","/**","* クエリを実行しその結果を配列で取得する","*","* @param obj  $link DBハンドル","* @param str  $sql SQL文","* @return array 結果配列データ","*/","function get_as_array($link, $sql) {"," ","    // 返却用配列","    $data = [];"," ","    // クエリを実行する","    if ($result = mysqli_query($link, $sql)) {"," ","        if (mysqli_num_rows($result) > 0) {"," ","            // １件ずつ取り出す","            while ($row = mysqli_fetch_assoc($result)) {","                $data[] = $row;","            }"," ","        }"," ","        // 結果セットを開放","        mysqli_free_result($result);"," ","    }"," ","    return $data;"," ","}"," ","/**","* 商品の一覧を取得する","*","* @param obj $link DBハンドル","* @return array 商品一覧配列データ","*/","function get_goods_table_list($link) {"," ","    // SQL生成","    $sql = 'SELECT goods_name, price FROM goods_table';"," ","    // クエリ実行","    return get_as_array($link, $sql);"," ","}"],"id":10}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"remove","lines":["p"],"id":11},{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"remove","lines":["h"]},{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"remove","lines":["p"]},{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"remove","lines":["?"]},{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"remove","lines":["<"]}],[{"start":{"row":32,"column":0},"end":{"row":34,"column":1},"action":"remove","lines":["function entity_str($str) {","    return htmlspecialchars($str, ENT_QUOTES, HTML_CHARACTER_SET);","}"],"id":12}]]},"ace":{"folds":[],"scrolltop":1125,"scrollleft":0,"selection":{"start":{"row":162,"column":2},"end":{"row":162,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":92,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1639200577987,"hash":"9e21d32185c838f424ba59ad242058cebb4e0356"}